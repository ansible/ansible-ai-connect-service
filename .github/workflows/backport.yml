name: Backport merged pull request

on:
  pull_request_target:
    types: [closed, labeled]

permissions:
  contents: write
  pull-requests: write

jobs:
  backport:
    name: Backport PR
    runs-on: ubuntu-latest

    if: github.event.pull_request.merged == true
    steps:

      - name: Backport to release branches
        uses: korthout/backport-action@v3
        with:
          label_pattern: '^backport/(?<target>.+)$'

          target_branches: |
            all:stable-2.4 stable-2.5 stable-2.6

          github_token: ${{ secrets.GITHUB_TOKEN }}

          copy_labels_pattern: '^(bug|security|breaking-change|dependencies)$'

          pull_description: |
            # Backport of #${pull_number}

            ${pull_description}

            ---

            **Original PR:** #${pull_number}
            **Backported by:** @${{ github.actor }}

            ## Backport Verification
            - [ ] Changes apply cleanly
            - [ ] Tests pass
            - [ ] No conflicts with target branch

          pull_title: "[Backport ${target_branch}] ${pull_title}"
