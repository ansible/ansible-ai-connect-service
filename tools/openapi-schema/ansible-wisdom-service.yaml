openapi: 3.0.3
info:
  title: Ansible Lightspeed with Watson Code Assistant Service
  version: 0.0.7
  description: Equip the automation developer at Lightspeed.
paths:
  /api/v0/ai/attributions/:
    post:
      operationId: ai_attributions_create
      description: Returns attributions that were the highest likelihood sources for
        a given code suggestion.
      summary: Code suggestion attributions
      tags:
      - ai
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AttributionRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/AttributionRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/AttributionRequest'
        required: true
      security:
      - oauth2:
        - read
        - write
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttributionResponse'
          description: ''
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '429':
          description: Request was throttled
        '503':
          description: Service Unavailable
  /api/v0/ai/completions/:
    post:
      operationId: ai_completions_create
      description: Returns inline code suggestions based on a given Ansible editor
        context.
      summary: Inline code suggestions
      tags:
      - ai
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompletionRequest'
            examples:
              ValidExample:
                value:
                  prompt: |
                    ---
                    - hosts: all
                      become: yes

                      tasks:
                      - name: Install ssh
                summary: Request Sample
                description: A valid sample request.
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/CompletionRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/CompletionRequest'
        required: true
      security:
      - oauth2:
        - read
        - write
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompletionResponse'
              examples:
                ValidExample:
                  value:
                    predictions:
                    - |2-
                          ansible.builtin.package:
                            name: openssh-server
                            state: present
                  summary: Response sample
                  description: A valid sample response.
          description: ''
        '204':
          description: Empty response
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '429':
          description: Request was throttled
        '503':
          description: Service Unavailable
  /api/v0/ai/feedback/:
    post:
      operationId: ai_feedback_create
      description: Feedback API for the AI service
      summary: Feedback API for the AI service
      tags:
      - ai
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackRequest'
            examples:
              ValidInlineSuggestionFeedbackExample:
                value:
                  inlineSuggestion:
                    latency: 1000
                    userActionTime: 5155
                    action: '0'
                    suggestionId: a1b2c3d4-e5f6-a7b8-c9d0-e1f2a3b4c5d6
                summary: Feedback Request sample for inline suggestion to identify
                  if the suggestion is accepted or ignored.
                description: A valid inline suggestion feedback sample request to
                  get details about the suggestion like latency time, user decision
                  time, user action and suggestion id.
              ValidAnsibleContentFeedbackExample:
                value:
                  ansibleContent:
                    content: |
                      ---
                      - hosts: all
                        become: yes

                        tasks:
                        - name: Install ssh
                    documentUri: file:///home/user/ansible/test.yaml
                    trigger: '0'
                summary: Feedback Request sample for Ansible content upload
                description: A valid sample request to get ansible content as feedback.
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/FeedbackRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/FeedbackRequest'
      security:
      - oauth2:
        - read
        - write
      - cookieAuth: []
      responses:
        '200':
          description: Success
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
  /api/v0/me/:
    get:
      operationId: me_retrieve
      tags:
      - me
      security:
      - cookieAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
          description: ''
  /check/:
    get:
      operationId: check_retrieve
      description: Lightspeed Service Liveness Probe View
      summary: Liveness probe
      tags:
      - check
      security:
      - {}
      responses:
        '200':
          description: OK
  /check/status/:
    get:
      operationId: check_status_retrieve
      description: Lightspeed Service Health Check
      summary: Health check with backend server status
      tags:
      - check
      security:
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
                additionalProperties: {}
              examples:
                ExampleOutput:
                  value:
                    status: ok
                    timestamp: '2023-03-13T17:25:17.240683'
                    version: latest 0.1.202303131417
                    git_commit: b987bc43b90f8aca2deaf3bda85596f4b95a10a0
                    model_name: ansible-wisdom-v09
                    dependencies:
                    - name: cache
                      status: ok
                      time_taken: 2.032
                    - name: db
                      status: ok
                      time_taken: 233.538
                    - name: model-server
                      status: ok
                      time_taken: 0.001
                  summary: Example output
          description: ''
        '500':
          description: One or more backend services are unavailable.
components:
  schemas:
    ActionEnum:
      enum:
      - '0'
      - '1'
      type: string
    AnsibleContentFeedback:
      type: object
      properties:
        content:
          type: string
          title: Ansible Content
          description: Ansible file content.
        documentUri:
          type: string
        trigger:
          $ref: '#/components/schemas/TriggerEnum'
        activityId:
          type: string
          format: uuid
          title: Activity ID
          description: A UUID that identifies a user activity session to the document
            uploaded.
      required:
      - content
      - documentUri
      - trigger
    Attribution:
      type: object
      properties:
        repo_name:
          type: string
        repo_url:
          type: string
          format: uri
        path:
          type: string
        license:
          type: string
        data_source:
          type: string
        ansible_type:
          type: string
        score:
          type: number
          format: double
      required:
      - ansible_type
      - data_source
      - license
      - path
      - repo_name
      - repo_url
      - score
    AttributionRequest:
      type: object
      properties:
        suggestion:
          type: string
        suggestionId:
          type: string
          format: uuid
          title: Suggestion ID
          description: A UUID that identifies the particular suggestion attribution
            data is being requested for.
      required:
      - suggestion
    AttributionResponse:
      type: object
      properties:
        attributions:
          type: array
          items:
            $ref: '#/components/schemas/Attribution'
      required:
      - attributions
    CompletionRequest:
      type: object
      properties:
        prompt:
          type: string
          description: Editor prompt.
        suggestionId:
          type: string
          format: uuid
          title: Suggestion ID
          description: A UUID that identifies a suggestion.
        metadata:
          $ref: '#/components/schemas/Metadata'
      required:
      - prompt
    CompletionResponse:
      type: object
      properties:
        predictions:
          type: array
          items:
            type: string
        # modelVersion:
        #   type: string
        #   readOnly: true
        # suggestionId:
        #   type: string
        #   format: uuid
        #   readOnly: true
      required:
      - predictions
    FeedbackRequest:
      type: object
      properties:
        inlineSuggestion:
          $ref: '#/components/schemas/InlineSuggestionFeedback'
        ansibleContent:
          $ref: '#/components/schemas/AnsibleContentFeedback'
    InlineSuggestionFeedback:
      type: object
      properties:
        latency:
          type: number
          format: double
        userActionTime:
          type: number
          format: double
        documentUri:
          type: string
        action:
          $ref: '#/components/schemas/ActionEnum'
        error:
          type: string
        suggestionId:
          type: string
          format: uuid
          title: Suggestion ID
          description: A UUID that identifies a suggestion.
        activityId:
          type: string
          format: uuid
          title: Activity ID
          description: A UUID that identifies a user activity session to the document
            uploaded.
      required:
      - action
      - suggestionId
    Metadata:
      type: object
      properties:
        documentUri:
          type: string
        activityId:
          type: string
          format: uuid
          title: Activity ID
          description: A UUID that identifies a user activity session within a given
            document.
    TriggerEnum:
      enum:
      - '0'
      - '1'
      - '2'
      type: string
    User:
      type: object
      properties:
        username:
          type: string
          description: Required. 150 characters or fewer. Letters, digits and @/./+/-/_
            only.
          pattern: ^[\w.@+-]+$
          maxLength: 150
      required:
      - username
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: sessionid
    oauth2:
      type: oauth2
      flows: {}
tags:
- name: ai
  description: AI-related operations
- name: me
  description: Authenticated user information
- name: check
  description: Health check
